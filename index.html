<!doctype html>
<html lang="en">
<head>
    <style>
        /* ... (styles CSS, y compris ceux pour la légende) ... */
        .ol-legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            z-index: 1000;
        }
        .ol-legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .ol-legend-icon {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            display: inline-block; /*Important pour l'alignement*/
            vertical-align: middle;
        }
        .legend-label{
            font-size: 10px;
            display: inline-block; /*Important pour l'alignement*/
            vertical-align: middle;
        }
    </style>
    <title></title>
</head>
<body>
    <div id="map">
        <div id="popup" class="ol-popup">
            <a href="#" id="popup-closer" class="ol-popup-closer"></a>
            <div id="popup-content"></div>
        </div>
    </div>
    <script src="resources/qgis2web_expressions.js"></script>
    <script src="resources/proj4.js"></script>
    <script>proj4.defs('EPSG:32645','+proj=utm +zone=45 +datum=WGS84 +units=m +no_defs');</script>
    <script src="./resources/functions.js"></script>
    <script src="./resources/ol.js"></script>
    <script src="./resources/ol-layerswitcher.js"></script>
    <script src="resources/ol-geocoder.js"></script>
    <script src="layers/kolkata_hostels_1.js"></script>
    <script src="layers/lieux_importants_2.js"></script>
    <script src="styles/kolkata_hostels_1_style.js"></script>
    <script src="styles/lieux_importants_2_style.js"></script>
    <script src="./layers/layers.js" type="text/javascript"></script>
    <script src="./resources/Autolinker.min.js"></script>
    <script src="./resources/qgis2web.js"></script>
    <script>
        var map = new ol.Map({
            target: 'map',
            layers: layersList,
            view: new ol.View({
                center: [9830846.12457471, 2561937.625686027],
                zoom: 12,
                maxZoom: 28,
                projection: 'EPSG:32645'
            })
        });

        function createLegend(map) {
            var legend = document.createElement('div');
            legend.className = 'ol-legend';
            legend.innerHTML = '<h4>Légende</h4>';

            map.getLayers().forEach(function(layer) {
                if (layer instanceof ol.layer.Vector) { // Vérifie que c'est une couche vectorielle
                    var source = layer.getSource();
                    if (source instanceof ol.source.Vector){
                        if (layer.get('title') === 'kolkata_hostels_1') {
                            var styleFunction = layer.getStyle();
                            var style = styleFunction(null, 0); // Obtient le style

                            if (style && style.getImage()) {
                                var fill = style.getImage().getFill();
                                var fillColor = fill ? fill.getColor() : 'gray';
                                legend.innerHTML += '<div class="ol-legend-item"><div class="ol-legend-icon" style="background-color: ' + fillColor + ';"></div><span class="legend-label">Foyers</span></div>';
                            }
                        }
                        if (layer.get('title') === 'lieux_importants_2') {
                            var styleFunction = layer.getStyle();
                            var style = styleFunction(null, 0);

                            if (style && style.getImage()) {
                                var fill = style.getImage().getFill();
                                var fillColor = fill ? fill.getColor() : 'blue'; //Couleur par défaut si pas de fill
                                legend.innerHTML += '<div class="ol-legend-item"><div class="ol-legend-icon" style="background-color: ' + fillColor + ';"></div><span class="legend-label">Lieux Importants</span></div>';
                            }
                        }
                    }
                }
            });
            return legend;
        }

        map.once('loadend', function() {
            var legend = createLegend(map);
            map.getTargetElement().appendChild(legend);
        });
    </script>
</body>
</html>
